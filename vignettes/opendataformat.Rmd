---
title: "opendataformat"
output: 
  rmarkdown::html_vignette:
    toc: true
vignette: >
  %\VignetteIndexEntry{opendataformat}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

Introducing the opendataformat package: Unleash the power of open data!

Tired of struggling to convert open data formats into R dataframes? Look no further and welcome the opendataformat package.

With just a few lines of code, you can convert a data package specified as opendataformat into an R dataframe (`read_opendf()`) or convert an R dataframe into a data package specified in the opendataformat (`write_opendf()`).

But wait, there's more! Our package goes beyond parsing. Accessing metadata has never been easier. Dive into the treasure trove of information stored in your R dataframes. Explore dataset labels, descriptions and valuable details about variables such as labels and value labels with the `docu_opendf()` function.

This vignette will guide you through a series of examples that demonstrate the possibilities of these functions. Let's get started!

# Example Workflow 

## Setup 

```{r setup}
library(opendataformat)
```

## Read the Open Data Format: `read_opendf()`

The opendataformat package provides example data that is specified as 'Open Data Format'. The example data is a ZIP file. It contains the data as a CSV file with 20 rows and 7 columns (`data.csv`) and the metadata as a XML file (`metadata.xml`). The metadata file describes the dataset and its variables. If you are interested in how these files look like, you can find an example in the Open Data Format git repository: [https://git.soep.de/opendata/specification/-/tree/main/external/example](https://git.soep.de/opendata/specification/-/tree/main/external/example)

Get the path to the example data:

```{r path to zip}
path <- system.file("extdata", "data.zip", package="opendataformat")
```


```{r read_opendf, comment = ""}
df <- read_opendf(input = path)
```

If you prefer not to use the example data provided and instead want to work with an Open Data Format file of your own choice, simply specify the file path to access your desired dataset. For instance:

```{r read_opendf choice, eval = FALSE, comment = ""}
df <- read_opendf(input = "../my_data.zip")
```

View the R Dataset
```{r view df, comment = ""}
df
```


## Explore Dataset Information: `docu_opendf()`

Explore dataset information through two methods. Firstly, you can browse metadata at the record level, providing an overview of the dataset. Alternatively, you have the option to examine specific variable details, allowing you to gain insights into selected data attributes.

By default, when using the `docu_opendf()` function, dataset-level information is presented through an HTML page. If you're utilizing RStudio, this page will be displayed within the RStudio viewer. Otherwise, it will open in your system's default web browser for seamless accessibility.

```{r docu_opendf, eval = FALSE}
docu_opendf(df)
```

In this vignette, where we aim to present example metadata, we utilize the `style` argument with the value set to `print`. This ensures that the information is conveniently displayed through the R console, serving our specific demonstration purposes. 

```{r docu_opendf print, eval = FALSE}
docu_opendf(df, style = "print")
```

<div>
<pre class = "sourceCode r">
  <code class = "sourceCode r">
    <span class = "sc"><b><u>Dataset</u></b></span> 
    <span class = "sc"><b>dataset:</b> bap</span>  
    <span class = "sc"><b>label:</b> Data from individual questionnaires 2010</span> 
    <span class = "sc"><b>description:</b> The data were collected as part of the SOEP-Core study using the</span>
    <span class = "sc">questionnaire "Living in Germany - Survey 2010 on the social situation - Personal</span>
    <span class = "sc">questionnaire for all." This questionnaire is addressed to the individual persons</span> 
    <span class = "sc">in the household. A view of the survey instrument can be found here:</span> 
    <span class = "sc">https://www.diw.de/documents/dokumentenarchiv/17/diw_01.c.369781.de/soepfrabo_personen_2010.pdf</span> 
    <span class = "sc"><b>url:</b> https://paneldata.org/soep-core/data/bap</span> 
  </code>  
</pre>
</div>

To obtain a comprehensive overview of all variables within the dataset, simply set the `variables` argument to `yes`.

```{r docu_opendf variables, eval = FALSE}
docu_opendf(df, variables = "yes")
```

If you are interested in just one specific variable, you can do this:

```{r docu_opendf selected variable default, eval = FALSE}
docu_opendf(df$bap9001)
```

or

```{r docu_opendf selected variable print, eval = FALSE}
docu_opendf(df$bap9001, style = "print")
```

<div>
<pre class = "sourceCode r">
  <code class = "sourceCode r">
    <span class = "sc"><b><u>Variables</u></b></span>
    <span class = "sc"><b>variable:</b> bap9001</span>
    <span class = "sc"><b>label:</b> Pressed For Time Last 4 Weeks</span>
    <span class = "sc"><b>description:</b> Frequency of feeling time pressure in the past 4 weeks</span>
    <span class = "sc"><b>type:</b> numeric</span>
    <span class = "sc"><b>url:</b> https://paneldata.org/soep-core/data/bap/bap9001</span>
    <span class = "sc"><b>categories:</b></span>
    <span class = "sc">value  labels</span>
    <span class = "sc">-2     Does not apply</span>
    <span class = "sc">-1     No Answer</span>
    <span class = "sc"> 1     Always</span>
    <span class = "sc"> 2     Often</span>
    <span class = "sc"> 3     Sometimes</span>
    <span class = "sc"> 4     Almost Never</span>
    <span class = "sc"> 5     Never</span>
  </code>  
</pre>
</div>    

Certain datasets offer metadata such as variable labels or value labels in multiple languages. To determine the languages supported by your dataset, you can simply set the `languages` argument to `all`. This setting enables you to identify the range of languages available for accessing the relevant metadata within your dataset.

```{r docu_opendf languages all, eval = FALSE}
docu_opendf(df$bap9001, languages = "all")
```

or 

```{r docu_opendf languages all print, eval = FALSE}
docu_opendf(df$bap9001, style = "print", languages = "all")
```

<div>
<pre class = "sourceCode r">
  <code class = "sourceCode r">
    <span class = "sc"><b><u>Variables</u></b></span>
    <span class = "sc"><b>variable:</b> bap9001</span>
    <span class = "sc"><b>label:</b> Pressed For Time Last 4 Weeks</span>
    <span class = "sc"><b>label_en:</b> Pressed For Time Last 4 Weeks</span>
    <span class = "sc"><b>label_de:</b> Eile, Zeitdruck letzten 4 Wochen</span>
    <span class = "sc"><b>description:</b> Frequency of feeling time pressure in the past 4 weeks</span>
    <span class = "sc"><b>description_en:</b> Frequency of feeling time pressure in the past 4 weeks</span>
    <span class = "sc"><b>description_de:</b> Häufigkeit des Gefühls von Zeitdruck in den letzten 4 Wochen</span>
    <span class = "sc"><b>type:</b> numeric</span>
    <span class = "sc"><b>url:</b> https://paneldata.org/soep-core/data/bap/bap9001</span>
    <span class = "sc"><b>categories:</b></span>
    <span class = "sc">value  labels            labels_en        labels_de</span>
    <span class = "sc">-2      Does not apply   Does not apply   trifft nicht zu</span>
    <span class = "sc">-1      No Answer        No Answer        keine Angabe</span>
    <span class = "sc"> 1      Always           Always           Immer</span>
    <span class = "sc"> 2      Often            Often            Oft</span>
    <span class = "sc"> 3      Sometimes        Sometimes        Manchmal</span>
    <span class = "sc"> 4      Almost Never     Almost Never     Fast nie</span>
    <span class = "sc"> 5      Never            Never            Nie</span>
  </code>  
</pre>
</div>    

If you have a specific language of interest, you can easily display it by utilizing the corresponding language code. Simply specify the desired language code to retrieve the metadata in the language of your choice. This enables you to access the specific language variant of variable labels, value labels. In this example we display the german version:

```{r docu_opendf languages code, eval = FALSE}
docu_opendf(df$bap9001, languages = "de")
```

or

```{r docu_opendf languages code print, eval = FALSE}
docu_opendf(df$bap9001, style = "print", languages = "de")
```

<div class = "sourceCode">
<pre class = "sourceCode r">
  <code class = "sourceCode r">
    <span class = "sc"><b><u>Variables</u></b></span>
    <span class = "sc"><b>variable:</b> bap9001</span>
    <span class = "sc"><b>label_de:</b> Eile, Zeitdruck letzten 4 Wochen</span>
    <span class = "sc"><b>description_de:</b> Häufigkeit des Gefühls von Zeitdruck in den letzten 4 Wochen</span>
    <span class = "sc"><b>type:</b> numeric</span>
    <span class = "sc"><b>url:</b> https://paneldata.org/soep-core/data/bap/bap9001</span>
    <span class = "sc"><b>categories:</b></span>
    <span class = "sc">value    labels_de</span>
    <span class = "sc">-2       trifft nicht zu</span>
    <span class = "sc">-1       keine Angabe</span>
    <span class = "sc"> 1       Immer</span>
    <span class = "sc"> 2       Oft</span>
    <span class = "sc"> 3       Manchmal</span>
    <span class = "sc"> 4       Fast nie</span>
    <span class = "sc"> 5       Nie</span>
  </code>  
</pre>
</div>    

Certainly! You can apply this function to the entire dataset, allowing you to access the desired information across all variables.

```{r docu_opendf languages code all data, eval = FALSE}
docu_opendf(df, variables = "yes", languages = "de")
```

If you prefer another display style you can use the datasets' metadata and write your own code: 

```{r docu own style, eval = TRUE, comment = ""}
for (i in names(df)) {
  cat(
    paste0(attributes(df[[i]])$name, ": ", attributes(df[[i]])$label, "\n")
  )
}
```

Or you can use tools from other packages:

```{r docu alternative, eval = FALSE, comment = ""}
library("labelled")
look_for(df, details = TRUE)
```

```
pos variable label                           col_type values          
 1   bap87    Current Health                  int      range: -2 - 5   
 2   bap9201  hours of sleep, normal workday  int      range: -2 - 9   
 3   bap9001  Pressed For Time Last 4 Weeks   int      range: -2 - 5   
 4   bap9002  Run-down, Melancholy Last 4 We~ int      range: -2 - 4   
 5   bap9003  Well-balanced Last 4 Weeks      int      range: -2 - 5   
 6   bap96    Height                          dbl      range: -2 - 1.98
 7   name     Firstname                       chr      range:  - Paul  
```

## Access Metadata

Browsing through datasets' metadata provides a valuable initial overview. However, when it comes time to dive into the analysis work, questions arise regarding the storage location of the metadata and the process of accessing and utilizing it. Let's explore how and where the metadata is stored, and how we can effectively access and leverage it for analysis purposes.

The metadata imported from the Open Data Format file into an R dataframe is stored as R attributes. By using the base R function `attributes()`, you can easily access this metadata. When providing the entire dataset to the function, R will display all the metadata describing the dataset as a whole in your console. 

```{r dataset attributes, comment = ""}
attributes(df)
```

Alternatively, if you provide a specific variable to the function, only the corresponding metadata for that variable will be printed.

```{r variable attributes, comment = ""}
attributes(df$bap87)
```

If you're interested in a particular attribute, you can access it using the dollar sign followed by the attribute name. For instance, let's consider accessing a variable label as an example. 

```{r variable label attributes, comment = ""}
attributes(df$bap87)$label
```

Moreover, you have the flexibility to copy, remove, and modify these attributes to suit your needs.

## Let's analyse and make use of the metadata

### Frequency Table

```{r table, comment = ""}
table(df$bap87, useNA = "ifany")
```

As expected, the frequency table displays the occurrence count of each variable value. Now, let's enhance the convenience of the frequency table by utilizing the value labels associated with the variables. To access the value labels, as explained in the preceding section, you can utilize the base R function `attributes()`. Let's proceed to examine them now:

```{r table attributes labels, comment = ""}
attributes(df$bap87)$labels
```

```{r table attributes labels_de, comment = ""}
attributes(df$bap87)$labels_de
```

```{r table factor, comment = ""}
table(
  factor(
    df$bap87, labels = names(attributes(df$bap87)$labels
                             )
    )
  )
```

To display the data in a language other than the default one, let's try German by appending the respective language code to the attribute name. For example, you can use $labels_de to access the German language labels and present the information accordingly.

```{r table factor german, comment = ""}
table(
  factor(
    df$bap87,
      labels=names(attributes(df$bap87)$labels_de)
    )
  )
```

### Recoding a Variable

We want to display the table with only valid answers. Therefore we set the values `-2` and `-1` to `NA`. Because we do not want to overwrite the original variable, we generate a new one:

```{r copy data, comment = ""}
bap87_rec <- df$bap87
```

We check the attributes of the metadata and notice they are also copied from the original variable to the new one: 

```{r check metadata, comment = ""}
attributes(bap87_rec)
```

Now we can set the negative values to NA: 

```{r NA, comment = ""}
for (row in 1:length(bap87_rec)) {
  if (!is.na(bap87_rec[row]) && bap87_rec[row] <= -1) {
    bap87_rec[row] <- NA
  }
}

table(bap87_rec, useNA = "ifany")
```

We notice that the copied values and value labels do not fit anymore:

```{r check metadata again, comment = ""}
attributes(bap87_rec)$labels
```

We'll change that specifically copy positions `3` to `7`, retaining the desired range of values and their respective value labels. 

```{r copy metadata to recoded var, comment = ""}
attributes(bap87_rec)$labels <- unname(attributes(df$bap87)$labels)[3:7] # values
names(attributes(bap87_rec)$labels) <- names(attributes(df$bap87)$labels)[3:7] # labels

attributes(bap87_rec)$labels
```

Do the same for the other language versions of the new recoded variable:

```{r remove language versions of labels, comment = ""}
attributes(bap87_rec)$labels_de <- unname(attributes(df$bap87)$labels_de)[3:7] # values
names(attributes(bap87_rec)$labels_de) <- names(attributes(df$bap87)$labels_de)[3:7] # labels

attributes(bap87_rec)$labels_en <- unname(attributes(df$bap87)$labels_en)[3:7] # values
names(attributes(bap87_rec)$labels_en) <- names(attributes(df$bap87)$labels_en)[3:7] # labels


```

We do also notice that the variable name is not adequate. We replace the name copied from the original variable with the new name `bap87_rec`.

```{r change variable name of recoded var, comment = ""}
attributes(bap87_rec)$name <- "bap87_rec"
attributes(bap87_rec)$name
```

Now we generate the frequency table by using the variable as a factor variable. 

```{r frequency table of recoded var, comment = ""}
table(
  factor(
    bap87_rec,
      labels=names(attributes(bap87_rec)$labels)
    )
  )
```

### Barplot

To create a barplot, we will utilize the recoded variable from the previous section. This example will demonstrate how to leverage metadata to create a more convenient and informative graph. By incorporating the metadata into the visualization, we can enhance the graph's interpretability and provide a clearer understanding of the data.

```{r barplot, comment = "", fig.height = 3, fig.width = 5, fig.align = "center"}
barplot(
  table(
  factor(
    bap87_rec,
      labels=names(attributes(bap87_rec)$labels)
    )
  ),
  main = attributes(bap87_rec)$description, # title
  xlab = paste0(
    attributes(bap87_rec)$name,": ", attributes(bap87_rec)$label), # label 
  sub = attributes(bap87_rec)$url, # subtitle
  cex.main = 0.9, cex.names = 0.7, cex.sub = 0.8, cex.axis = 0.6, cex.lab = 0.7 # font sizes
)
```
Drawing a barplot with the German description becomes effortless when dealing with dates that have multiple language versions of labels and descriptions. Simply append the language code to the end of the label attributes, and you'll be able to generate the desired barplot with the German description:

```{r barplot german, comment = "", fig.height = 3, fig.width = 5, fig.align = "center"}
barplot(
  table(
  factor(
    bap87_rec,
      labels=names(attributes(bap87_rec)$labels_de)
    )
  ),
  main = attributes(bap87_rec)$description_de, # title
  xlab = paste0(
    attributes(bap87_rec)$name,": ", attributes(bap87_rec)$label_de), # label 
  sub = attributes(bap87_rec)$url, # subtitle
  cex.main = 0.7, cex.names = 0.5, cex.sub = 0.8, cex.axis = 0.7, cex.lab = 0.7 # font sizes
)
```


## Export to the Open Data Format: `write_opendf()`

As we want the newly generated variable also be part of the dataset, we first add it to the original dataframe:

```{r add var to df, comment = ""}
df_rec <- df
df_rec['bap87_rec'] <- bap87_rec

names(df_rec)

```


```{r write_opendf, comment = "", eval = FALSE}
write_opendf(
  df_rec, 
  "../data_rec"
)
```

The XML file metadata.xml and the CSV file data.csv are saved within the directory 'data_rec',as well as within the ZIP file 'data_rec.zip. The dataset looks the same as before just with a new additional variable:

```xml
<?xml version='1.0' encoding='utf-8'?>
<codeBook xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="ddi:codebook:2_5 http://www.ddialliance.org/Specification/DDI-Codebook/2.5/XMLSchema/codebook.xsd" xmlns="ddi:codebook:2_5" version="2.5">
	<fileDscr>
		<fileTxt>
			<fileName>bap</fileName>
			<fileCont>The data were collected as part of the SOEP-Core study using the questionnaire "Living in Germany - Survey 2010 on the social situation - Personal questionnaire for all. This questionnaire is addressed to the individual persons in the household. A view of the survey instrument can be found here: https://www.diw.de/documents/dokumentenarchiv/17/diw_01.c.369781.de/soepfrabo_personen_2010.pdf</fileCont>
			<fileCont xml:lang="en">The data were collected as part of the SOEP-Core study using the questionnaire "Living in Germany - Survey 2010 on the social situation - Personal questionnaire for all. This questionnaire is addressed to the individual persons in the household. A view of the survey instrument can be found here: https://www.diw.de/documents/dokumentenarchiv/17/diw_01.c.369781.de/soepfrabo_personen_2010.pdf</fileCont>
			<fileCont xml:lang="de">Die Daten wurden im Rahmen der Studie SOEP-Core mittels des Fragebogens „Leben in Deutschland – Befragung 2010 zur sozialen Lage - Personenfragebogen für alle“ erhoben. Dieser Fragebogen richtet sich an die einzelnen Personen im Haushalt. Eine Ansicht des Erhebungsinstrumentes finden Sie hier: https://www.diw.de/documents/dokumentenarchiv/17/diw_01.c.369781.de/soepfrabo_personen_2010.pdf</fileCont>
			<fileCitation>
				<titlStmt>
					<titl>Data from individual questionnaires 2010</titl>
					<titl xml:lang="en">Data from individual questionnaires 2010</titl>
					<titl xml:lang="de">Daten vom Personenfragebogen 2010</titl>
				</titlStmt>
			</fileCitation>
		</fileTxt>
		<notes>
			<ExtLink URI="https://paneldata.org/soep-core/data/bap" />
		</notes>
	</fileDscr>
	<dataDscr>
		<var name="bap87">
			<labl>Current Health</labl>
			<labl xml:lang="en">Current Health</labl>
			<labl xml:lang="de">Gesundheitszustand gegenwärtig</labl>
			<txt>Question: How would you describe your current health?</txt>
			<txt xml:lang="en">Question: How would you describe your current health?</txt>
			<txt xml:lang="de">Frage: Wie würden Sie Ihren gegenwärtigen Gesundheitszustand beschreiben?</txt>
			<notes>
				<ExtLink URI="https://paneldata.org/soep-core/data/bap/bap87" />
			</notes>
			<varFormat type="numeric" />
			<catgry>
				<catValu>-2</catValu>
				<labl>Does not apply</labl>
				<labl xml:lang="en">Does not apply</labl>
				<labl xml:lang="de">trifft nicht zu</labl>
			</catgry>
			<catgry>
				<catValu>-1</catValu>
				<labl>No Answer</labl>
				<labl xml:lang="en">No Answer</labl>
				<labl xml:lang="de">keine Angabe</labl>
			</catgry>
			<catgry>
				<catValu>1</catValu>
				<labl>Very good</labl>
				<labl xml:lang="en">Very good</labl>
				<labl xml:lang="de">Sehr gut</labl>
...

```
And also the data.csv file now includes the recoded variable `bap87_rec`:

```csv
"bap87","bap9201","bap9001","bap9002","bap9003","bap96","name","bap87_rec"
4,-2,1,-1,2,-2,"Jakob",4
3,5,-2,1,4,1.57,"Luca",3
,-1,-1,2,-1,1.92,"Emilia",
1,9,-2,2,4,1.85,"-1",1
-1,4,2,3,1,1.91,"Johanna",
3,4,-1,4,-2,1.8,"Paul",3
1,9,2,-1,-1,1.8,"",1

...

```

To export a specific variable of interest, you can utilize the write_opendf() function by applying the desired variable: 

```{r write_opendf variable selection, comment = "", eval = FALSE}
write_opendf(
  df_rec$bap87_rec, 
  "../data_bap87_rec"
)
```

The directory `data_bap87_rec` and the ZIP file `data_bap87_rec.zip` holds an XML file containing the metadata of that variable and a CSV file holding the data:

```xml
<?xml version='1.0' encoding='utf-8'?>
<codeBook xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="ddi:codebook:2_5 http://www.ddialliance.org/Specification/DDI-Codebook/2.5/XMLSchema/codebook.xsd" xmlns="ddi:codebook:2_5" version="2.5">
	<dataDscr>
		<var name="bap87_rec">
			<labl>Current Health</labl>
			<labl xml:lang="en">Current Health</labl>
			<labl xml:lang="de">Gesundheitszustand gegenwärtig</labl>
			<txt>Question: How would you describe your current health?</txt>
			<txt xml:lang="en">Question: How would you describe your current health?</txt>
			<txt xml:lang="de">Frage: Wie würden Sie Ihren gegenwärtigen Gesundheitszustand beschreiben?</txt>
			<notes>
				<ExtLink URI="https://paneldata.org/soep-core/data/bap/bap87" />
			</notes>
			<varFormat type="numeric" />
			<catgry>
				<catValu>1</catValu>
				<labl>Very good</labl>
				<labl xml:lang="en">Very good</labl>
				<labl xml:lang="de">Sehr gut</labl>
			</catgry>
			<catgry>
				<catValu>2</catValu>
				<labl>Good</labl>
				<labl xml:lang="en">Good</labl>
				<labl xml:lang="de">Gut</labl>
			</catgry>
			<catgry>
				<catValu>3</catValu>
				<labl>Satisfactory</labl>
				<labl xml:lang="en">Satisfactory</labl>
				<labl xml:lang="de">Zufriedenstellend</labl>
			</catgry>
			<catgry>
				<catValu>4</catValu>
				<labl>Poor</labl>
				<labl xml:lang="en">Poor</labl>
				<labl xml:lang="de">Weniger gut</labl>
			</catgry>
			<catgry>
				<catValu>5</catValu>
				<labl>Bad</labl>
				<labl xml:lang="en">Bad</labl>
				<labl xml:lang="de">Schlecht</labl>
			</catgry>
		</var>
	</dataDscr>
</codeBook>
```

```csv
"x"
4
3

1

3
1
5
5



3
2
5
4
3
3

2
```

If you wish to export only the metadata for documentation or archiving purposes, you can achieve this by setting the export_data argument to "no". By doing so, the resulting directory or zip file will solely contain the metadata XML file, excluding the data CSV file. This allows you to specifically capture and preserve the metadata without including the actual data, providing a solution for documentation or archiving needs.


```{r write_opendf variable, comment = "", eval = FALSE}
write_opendf(
  df_rec$bap87_rec, 
  "../data_bap87_rec_metadata",
  export_data = "no"
)
```

# Language Selection

## Import multilingual datasets with specific language selection: read_opendf()

By default the `read_opendf()` function imports all available languages. When working with a multilingual dataset and having a specific language of interest, you can make use of the `languages` argument to import only the desired language. By specifying either the `default` language or the language `code` corresponding to your preferred language, you can selectively import the dataset with the specific language variant you require. 

```{r read_opendf de, comment = ""}
df_de<- read_opendf(input = path, languages = "de")
```

or

```{r read_opendf choice de, eval = FALSE, comment = ""}
df_de <- read_opendf(input = "../my_data.zip", languages = "de")
```

Check the import with `docu_opendf()`:

```{r docu_opendf choice de, eval = FALSE, comment = ""}
docu_opendf(df_de)
```

<div class = "sourceCode">
<pre class = "sourceCode r">
  <code class = "sourceCode r">
    <span class = "sc"><b><u>Variables</u></b></span>
    <span class = "sc"><b>variable:</b> bap9001</span>
    <span class = "sc"><b>label_de:</b> Eile, Zeitdruck letzten 4 Wochen</span>
    <span class = "sc"><b>description_de:</b> Häufigkeit des Gefühls von Zeitdruck in den letzten 4 Wochen</span>
    <span class = "sc"><b>type:</b> numeric</span>
    <span class = "sc"><b>url:</b> https://paneldata.org/soep-core/data/bap/bap9001</span>
    <span class = "sc"><b>categories:</b></span>
    <span class = "sc">value    labels_de</span>
    <span class = "sc">-2       trifft nicht zu</span>
    <span class = "sc">-1       keine Angabe</span>
    <span class = "sc"> 1       Immer</span>
    <span class = "sc"> 2       Oft</span>
    <span class = "sc"> 3       Manchmal</span>
    <span class = "sc"> 4       Fast nie</span>
    <span class = "sc"> 5       Nie</span>
  </code>  
</pre>
</div>    

## Export multilingual datasets with specific language selection: export_opendf()

By default the `export_opendf()` function writes all available languages. When working with a multilingual dataset and having a specific language of interest, you can make use of the `languages` argument to export only the desired language. By specifying either the `default` language or the language `code` corresponding to your preferred language, you can selectively export the dataset with the specific language variant you require. 

```{r write_opendf variable default, comment = "", eval = FALSE}
write_opendf(
  df$bap87, 
  "../data_bap87_default",
  languages = "default"
)
```
```xml
<?xml version='1.0' encoding='utf-8'?>
<codeBook xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="ddi:codebook:2_5 http://www.ddialliance.org/Specification/DDI-Codebook/2.5/XMLSchema/codebook.xsd" xmlns="ddi:codebook:2_5" version="2.5">
	<dataDscr>
		<var name="bap87">
			<labl>Current Health</labl>
			<txt>Question: How would you describe your current health?</txt>
			<notes>
				<ExtLink URI="https://paneldata.org/soep-core/data/bap/bap87" />
			</notes>
			<varFormat type="numeric" />
			<catgry>
				<catValu>-2</catValu>
				<labl>Does not apply</labl>
			</catgry>
			<catgry>
				<catValu>-1</catValu>
				<labl>No Answer</labl>
			</catgry>
			<catgry>
				<catValu>1</catValu>
				<labl>Very good</labl>
			</catgry>
			<catgry>
				<catValu>2</catValu>
				<labl>Good</labl>
			</catgry>
			<catgry>
				<catValu>3</catValu>
				<labl>Satisfactory</labl>
			</catgry>
			<catgry>
				<catValu>4</catValu>
				<labl>Poor</labl>
			</catgry>
			<catgry>
				<catValu>5</catValu>
				<labl>Bad</labl>
			</catgry>
		</var>
	</dataDscr>
</codeBook>
```

Or you choose the language by language code:

```{r write_opendf variable de, comment = "", eval = FALSE}
write_opendf(
  df$bap87, 
  "../data_bap87_de",
  languages = "de"
)
```
```xml
<?xml version='1.0' encoding='utf-8'?>
<codeBook xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="ddi:codebook:2_5 http://www.ddialliance.org/Specification/DDI-Codebook/2.5/XMLSchema/codebook.xsd" xmlns="ddi:codebook:2_5" version="2.5">
	<dataDscr>
		<var name="bap87">
			<labl xml:lang="de">Gesundheitszustand gegenwärtig</labl>
			<txt xml:lang="de">Frage: Wie würden Sie Ihren gegenwärtigen Gesundheitszustand beschreiben?</txt>
			<notes>
				<ExtLink URI="https://paneldata.org/soep-core/data/bap/bap87" />
			</notes>
			<varFormat type="numeric" />
			<catgry>
				<catValu>-2</catValu>
				<labl xml:lang="de">trifft nicht zu</labl>
			</catgry>
			<catgry>
				<catValu>-1</catValu>
				<labl xml:lang="de">keine Angabe</labl>
			</catgry>
			<catgry>
				<catValu>1</catValu>
				<labl xml:lang="de">Sehr gut</labl>
			</catgry>
			<catgry>
				<catValu>2</catValu>
				<labl xml:lang="de">Gut</labl>
			</catgry>
			<catgry>
				<catValu>3</catValu>
				<labl xml:lang="de">Zufriedenstellend</labl>
			</catgry>
			<catgry>
				<catValu>4</catValu>
				<labl xml:lang="de">Weniger gut</labl>
			</catgry>
			<catgry>
				<catValu>5</catValu>
				<labl xml:lang="de">Schlecht</labl>
			</catgry>
		</var>
	</dataDscr>
</codeBook>
```


<!-- devtools::build_rmd("vignettes/opendataformat.Rmd") -->
